# vncpike

**NoVncPikeJS** - браузерный VNC клиент 

**VncPikeRepeater** - node.js репитер

**VncPikeSharp** - библиотеки и модули VNC сервера и десктопного VNC клиента

Общая схема работы системы
http://joxi.ru/12MN7X0Cl45JZA

Vnc клиенты делятся на VncViewer и VncLooker. Функционально они ничем не отличаются, кроме того что подключаются к разным портам репитера. При этом VncLooker НЕ имеет права на управление удаленным компьютером.
VncServer - транслирует экран удаленного компьютера и принимает команды от VncViewer
VncRepeater обеспечивает взаимодействие между частями системы

**Краткое описание работы**

На транслируемом компьютере запускается VncServer. Он периодически пытается подключиться к VncRepeater. После подключения сервер передает версию своего протокола и ожидает начала обмена.

VncRepeater держит подключение от VncServer и ждет подключения VncViewer. Если подключение в течении 10 секунд не состоялось, то соединение с сервером обрывается и дальше сервер самостоятельно переаодключается

После подключения VncViewer происходит открытие сессии и происходит обмен по протоколу RFB (данный протокол немного изменен для работы в этой системе)

Весь обмен проходит через Interceptor, который представляет собой упрощенный аналог Vnc клиента и служит только для формирования актуального FrameBuffer в памяти.

После того как обмен состоялся и началась работа по передаче команд и картинки, становится возможным прием подключений VncLooker. Для работы с VncLooker применяется упрощенный аналог VncServer, который НЕ обрабатывает команды от VncLooker, кроме команды обновления FrameBuffer.

Авторизация VncLooker происходит по отдельному паролю, который задается на VncServer

**Запуск VNC сервера должен производиться с параметрами**

VncPikeServer 123123 "Test server" 127.0.0.1 5500 "test" "test1" 0 0 1920 1080

1. Идентификатор сервера для работы с репитером. Любое произвольное целое положительное int32;
2. Имя сервера (отображается в заголовке окна клиента);
3,4. Адрес и порт Vnc Repeater;
5. Пароль для VncViewer;
6. Пароль для VncLooker;
7,8,9,10. Bounds (x, y, width, height в пикселах относительно левого верхнего угла) передаваемой части экрана. Параметры не обязательные, если их не передавать, будет транслироваться весь экран.


**Запуск VNC Repeater**

node app.js 5912 5500 5950

1. Порт для подключения VncViewer;
2. Порт для подключения VncRepeater;
3. Порт для подключения VncLooker.

**Запуск noVnc**

Для подключения noVnc необходимо запустить websockify
